
# Автоматизированная система управления автопарком лизинговой компании

## Frontend - Vue.js приложение

### Описание
Frontend часть системы представляет собой современное одностраничное приложение (SPA) для управления автопарком лизинговой компании. Приложение построено на Vue.js 3 с использованием Composition API и Vuetify 3 для создания профессионального пользовательского интерфейса. Система разделена на две части: публичный интерфейс для клиентов и административную панель для сотрудников компании.

### Технологии
- **Vue.js 3.4** - прогрессивный JavaScript фреймворк
- **Vuetify 3.5** - Material Design компоненты для Vue
- **Vue Router 4.2** - маршрутизация
- **Vuex 4.0** - управление состоянием
- **Axios 1.6** - HTTP клиент
- **@vue/cli** - сборщик и dev-сервер
- **Material Design Icons** - иконки Material Design

### Установка и запуск

#### Требования
- Node.js версии 18.0 или выше
- npm или yarn для управления зависимостями
- Работающий Django бэкенд с API на http://localhost:8000

#### Установка зависимостей
```bash
    cd frontend
npm install
```

#### Запуск в режиме разработки
```bash
npm run serve
```
Приложение будет доступно по адресу: http://localhost:8080

#### Сборка для production
```bash
npm run build
```

### Архитектура приложения

#### Структура проекта
```
src/
├── api/              # Настройки API и эндпоинты
├── assets/           # Статические ресурсы
├── components/       # Переиспользуемые компоненты
├── plugins/          # Плагины Vuetify
├── router/           # Конфигурация маршрутизации
├── store/            # Vuex хранилище
└── views/            # Основные страницы приложения
    ├── admin/        # Административная панель
    │   ├── applications/  # Управление заявками
    │   ├── cars/          # Управление автомобилями
    │   ├── clients/       # Управление клиентами
    │   ├── leases/        # Управление договорами
    │   └── maintenance/   # Управление обслуживанием
    └── cars/         # Публичный раздел автомобилей
```

#### Компоненты

**Главный компонент (App.vue)**
- Управление авторизацией
- Главный layout приложения
- Навигация между публичной и админской частями

**Страницы (Views)**

*Публичная часть:*
- **HomeView** - Главная страница с информацией о компании
- **Login.vue** - Страница входа в систему
- **Register.vue** - Страница регистрации сотрудников
- **Profile.vue** - Личный кабинет пользователя
- **CarsList.vue** - Каталог доступных автомобилей для аренды
- **CarDetail.vue** - Детальная страница автомобиля
- **CarApplication.vue** - Форма подачи заявки на аренду

*Административная панель:*
- **AdminLayout.vue** - Основной layout админки с боковым меню
- **Dashboard.vue** - Дашборд с основной статистикой
- **AdminReports.vue** - Система отчетов (доходы, загрузка, обслуживание)
- **AdminCarList.vue** - Управление автомобилями
- **AdminCarDetail.vue** - Детальная информация об автомобиле
- **AdminCarForm.vue** - Форма добавления/редактирования автомобиля
- **CarMaintenance.vue** - История обслуживания автомобиля
- **CarSpecificationDetail.vue** - Просмотр характеристик автомобиля
- **CarSpecificationForm.vue** - Форма добавления характеристик
- **AdminClientList.vue** - Управление клиентами
- **AdminClientDetail.vue** - Детальная информация о клиенте
- **AdminLeaseList.vue** - Управление договорами аренды
- **AdminLeaseDetail.vue** - Детальная информация о договоре
- **AdminApplicationList.vue** - Управление заявками на аренду
- **AdminApplicationDetail.vue** - Детальная информация о заявке
- **AdminMaintenanceCompanyList.vue** - Управление сервисными компаниями
- **AdminMaintenanceCompanyDetail.vue** - Детальная информация о сервисной компании
- **AdminMaintenanceCompanyForm.vue** - Форма добавления/редактирования сервисной компании

### Сервисы и API

#### Настройка Axios
```javascript
// main.js
axios.defaults.baseURL = 'http://localhost:8000/api/'

// Интерцептор для добавления JWT токена
axios.interceptors.request.use(config => {
    const token = localStorage.getItem('token')
    if (token) {
        config.headers.Authorization = `Bearer ${token}`
    }
    return config
})
```

#### Основные API эндпоинты

**Аутентификация:**
- `POST /auth/users/` - регистрация сотрудника
- `POST /auth/jwt/create/` - вход в систему
- `POST /auth/jwt/refresh/` - обновление токена
- `GET /auth/users/me/` - данные текущего пользователя
- `PATCH /auth/users/me/` - обновление профиля
- `POST /auth/users/set_password/` - смена пароля

**Автомобили:**
- `GET /cars/` - список автомобилей (публичный)
- `GET /admin/cars/` - список автомобилей (админка)
- `GET /admin/cars/{id}/` - детали автомобиля
- `POST /admin/cars/` - создание автомобиля
- `PATCH /admin/cars/{id}/` - обновление автомобиля
- `POST /admin/cars/{id}/specifications/create` - добавление характеристик
- `GET /admin/cars/{id}/maintenance/` - история обслуживания
- `POST /admin/cars/{id}/maintenance/` - добавление записи об обслуживании

**Характеристики автомобилей:**
- `GET /admin/car_specifications/` - список всех характеристик
- `PATCH /admin/car_specifications/` - обновление характеристик
- `DELETE /admin/car_specifications/` - удаление характеристик

**Клиенты:**
- `GET /admin/clients/` - список клиентов
- `GET /admin/clients/{id}/` - детали клиента
- `POST /admin/clients/` - создание клиента
- `PATCH /admin/clients/{id}/` - обновление клиента
- `DELETE /admin/clients/{id}/` - удаление клиента

**Договоры аренды:**
- `GET /admin/leases/` - список договоров
- `GET /admin/leases/{id}/` - детали договора
- `PATCH /admin/leases/` - обновление договора
- `POST /admin/leases/` - создание договора

**Заявки на аренду:**
- `GET /admin/lease_applications/` - список заявок
- `GET /admin/lease_applications/{id}/` - детали заявки
- `POST /admin/lease_applications/{id}/approve/` - одобрение заявки
- `DELETE /admin/lease_applications/{id}/` - удаление заявки

**Компании по обслуживанию:**
- `GET /admin/maintenance_companies/` - список компаний
- `GET /admin/maintenance_companies/{id}/` - детали компании
- `POST /admin/maintenance_companies/` - создание компании
- `PATCH /admin/maintenance_companies/{id}/` - обновление компании
- `DELETE /admin/maintenance_companies/{id}/` - удаление компании

**Отчеты:**
- `GET /admin/reports/revenue/` - отчет по доходам
- `GET /admin/reports/utilization/` - отчет по загрузке автопарка
- `GET /admin/reports/maintenance_costs/` - отчет по затратам на обслуживание

### Управление состоянием (Vuex)

#### Auth Store (`store/modules/auth.js`)
Управление состоянием аутентификации:

```javascript
const state = {
    user: null,
    token: localStorage.getItem('token') || null,
    loading: false,
    error: null
}

const getters = {
    isAuthenticated: state => !!state.token,
    currentUser: state => state.user
}

const mutations = {
    SET_TOKEN(state, token) {
        state.token = token
        localStorage.setItem('token', token)
    },
    SET_USER(state, user) {
        state.user = user
    },
    LOGOUT(state) {
        state.token = null
        state.user = null
        localStorage.removeItem('token')
    }
}

const actions = {
    async login({ commit }, credentials) {
        // Логика входа
    },
    async logout({ commit }) {
        commit('LOGOUT')
    },
    async fetchCurrentUser({ commit }) {
        // Загрузка данных пользователя
    }
}
```

### Маршрутизация (Vue Router)

#### Публичные маршруты
```javascript
{
    path: '/cars',
    name: 'CarsList',
    component: CarsList
},
{
    path: '/cars/:id',
    name: 'CarDetail',
    component: CarDetail,
    props: true
},
{
    path: '/cars/:id/application',
    name: 'CarApplication',
    component: CarApplication,
    props: true,
    meta: { requiresAuth: true }
},
... и другие
```

#### Административные маршруты
```javascript
{
    path: '/admin',
    component: AdminLayout,
    meta: { requiresAuth: true, requiresAdmin: true },
    children: [
        {
            path: '',
            name: 'AdminDashboard',
            component: Dashboard
        },
        {
            path: 'reports',
            name: 'AdminReports',
            component: AdminReports
        },
        {
            path: 'cars',
            name: 'AdminCars',
            component: AdminCarList
        },
        // ... остальные админ-маршруты
    ]
}
```

#### Защита маршрутов
- Все административные маршруты требуют аутентификации и прав администратора
- Публичные маршруты доступны всем пользователям
- Автоматический редирект на /login при отсутствии токена
- Проверка JWT токена при каждом запросе через axios interceptor

### Аутентификация и авторизация

#### Процесс входа
1. Пользователь вводит username и password
2. Отправляется POST запрос на `/auth/jwt/create/`
3. При успешной аутентификации JWT токен сохраняется в localStorage
4. Токен автоматически добавляется к каждому API запросу через axios interceptor
5. Загружаются данные пользователя через `/auth/users/me/`

#### Обновление токена
Система поддерживает автоматическое обновление JWT токенов:
- При получении ошибки 401 (Unauthorized) проверяется наличие refresh токена
- Автоматическая отправка запроса на `/auth/jwt/refresh/`
- Обновление access токена без необходимости повторного входа

#### Хранение токена
- Access token хранится в localStorage
- При каждом запросе добавляется в заголовок `Authorization: Bearer <token>`
- При выходе из системы токен удаляется из localStorage

### UI/UX особенности

#### Vuetify компоненты
Приложение использует Material Design компоненты из Vuetify 3:
- **v-data-table** - таблицы с пагинацией, сортировкой и фильтрацией
- **v-dialog** - модальные окна для форм создания/редактирования
- **v-form** - формы с комплексной валидацией
- **v-tabs** - вкладки для организации контента
- **v-card** - карточки для структурированного отображения информации
- **v-chip** - чипы для статусов и категорий
- **v-alert** - уведомления об ошибках и успешных операциях
- **v-progress-linear** - индикаторы загрузки

#### Валидация форм
Все формы имеют многоуровневую валидацию:
- Проверка обязательных полей
- Валидация форматов (email, даты, номера)
- Проверка диапазонов значений
- Сравнение паролей при регистрации и смене пароля
- Отображение ошибок под соответствующими полями

#### Пагинация и фильтрация
- Все таблицы поддерживают пагинацию (по умолчанию 5-10 элементов на странице)
- Фильтрация по статусам, датам, текстовым полям
- Сортировка по ключевым элементам
- Поиск по ключевым полям (марка автомобиля, название компании и т.д.)

#### Обработка ошибок
- Отображение ошибок валидации под полями форм
- Глобальные уведомления об ошибках API
- Уведомления об успешных операциях с автоматическим скрытием
- Обработка сетевых ошибок и ошибок сервера

### Основные бизнес-процессы системы

#### 1. Добавление нового автомобиля в автопарк
**Процесс:**
1. Администратор переходит в раздел "Автомобили" → "Добавить автомобиль"
2. Заполняет основную информацию: марка, модель, год, VIN, гос. номер
3. После сохранения добавляет технические характеристики:
   - Тип двигателя, объем, мощность
   - Коробка передач, привод, тип кузова
   - Расход топлива, цвет, дополнительные опции
4. Автомобиль появляется в каталоге с статусом "Доступен"

**Техническая реализация:**
```javascript
// AdminCarForm.vue - форма добавления автомобиля
const submitForm = async () => {
    const response = await axios.post('admin/cars/', formData)
    // После успешного создания - переход к добавлению характеристик
    router.push(`/admin/cars/${response.data.id}/specifications/create`)
}
```

#### 2. Создание компании по обслуживанию и добавление записи об обслуживании
**Процесс:**
1. Администратор создает компанию по обслуживанию через раздел "Обслуживание" → "Добавить компанию"
2. Указывает название, телефон и адрес компании
3. Для конкретного автомобиля добавляет запись об обслуживании:
   - Выбирает сервисную компанию из списка
   - Указывает дату, вид обслуживания, стоимость
   - Добавляет описание выполненных работ
4. Запись сохраняется в истории обслуживания автомобиля

**Техническая реализация:**
```javascript
// CarMaintenance.vue - добавление обслуживания
const addMaintenance = async () => {
    const payload = {
        maintenance_company: selectedCompany.id,
        date: maintenanceForm.date,
        service: maintenanceForm.service,
        cost: maintenanceForm.cost,
        description: maintenanceForm.description,
        car: carId
    }
    await axios.post(`admin/cars/${carId}/maintenance/`, payload)
}
```

#### 3. Получение отчетов о деятельности компании
**Процесс:**
1. Администратор переходит в раздел "Отчеты"
2. Выбирает тип отчета:
   - **Отчет по доходам**: общий доход по аренде, количество договоров
   - **Отчет по загрузке**: средняя загрузка автопарка, дни аренды по автомобилям
   - **Отчет по обслуживанию**: общие затраты, средние затраты на авто
3. Получает данные в виде таблиц с агрегированной статистикой
4. Может экспортировать данные для анализа

**Техническая реализация:**
```javascript
// AdminReports.vue - загрузка отчетов
const fetchRevenueReport = async () => {
    const response = await axios.get('admin/reports/revenue/')
    revenueData.value = response.data.results
    // Расчет статистики
    revenueStats.value.totalLeases = revenueData.value.reduce((sum, item) => sum + item.leasings_count, 0)
    revenueStats.value.totalIncome = revenueData.value.reduce((sum, item) => sum + (item.total_income || 0), 0)
}
```

#### 4. Подача заявки на аренду и ее обработка
**Процесс:**
**Со стороны клиента:**
1. Клиент просматривает каталог доступных автомобилей
2. Выбирает понравившийся автомобиль и нажимает "Арендовать"
3. Заполняет заявку с указанием компании и контактных данных
4. Заявка отправляется на рассмотрение

**Со стороны администратора:**
1. В разделе "Заявки" видит новую заявку
2. Проверяет доступность автомобиля
3. Варианты действий:
   - **Одобрить**: создать договор аренды с указанием дат и стоимости
   - **Отклонить**: удалить заявку с указанием причины
4. При одобрении автоматически создается договор, автомобиль переводится в статус "В аренде"

**Техническая реализация:**
```javascript
// AdminApplicationDetail.vue - одобрение заявки
const approveApplication = async () => {
    const payload = {
        start_date: approveForm.start_date,
        end_date: approveForm.end_date,
        monthly_payment: approveForm.monthly_payment
    }
    const response = await axios.post(`admin/lease_applications/${applicationId}/approve/`, payload)
    // Извлечение ID созданного договора из сообщения
    const leaseId = response.data.success.match(/Договор #(\d+)/)[1]
}
```

### Сущности и связи системы

#### Основные сущности:
1. **AdminUser** - Сотрудник компании
   - Аутентификация через Django
   - Поля: username, email, phone, position

2. **Client** - Компания-клиент
   - Юридическое лицо, арендующее автомобили
   - Поля: company_name, inn, email, phone, address, contact_person

3. **Car** - Автомобиль
   - Основная сущность автопарка
   - Статусы: available, leased, maintenance, sold
   - Поля: make, model, year, vin, license_plate, status

4. **CarSpecification** - Характеристики автомобиля
   - OneToOne связь с Car
   - Поля: engine_type, engine_volume, horsepower, transmission, drivetrain, body_type

5. **Lease** - Договор аренды
   - Связывает Car и Client
   - Статусы: active, completed, cancelled
   - Поля: start_date, end_date, monthly_payment, status

6. **LeaseApplication** - Заявка на аренду
   - Предварительная заявка от клиента
   - Связывает Car и Client до создания договора

7. **MaintenanceCompany** - Компания по обслуживанию
   - Сервисные центры и СТО
   - Поля: name, phone, address

8. **Maintenance** - Запись об обслуживании
   - История обслуживания автомобиля
   - Поля: date, service, cost, description
   - Связывает Car и MaintenanceCompany

#### Связи между сущностями:
- **Car** → **CarSpecification** (OneToOne)
- **Car** → **Lease** (OneToMany)
- **Car** → **LeaseApplication** (OneToMany)
- **Car** → **Maintenance** (OneToMany)
- **Client** → **Lease** (OneToMany)
- **Client** → **LeaseApplication** (OneToMany)
- **MaintenanceCompany** → **Maintenance** (OneToMany)
- **AdminUser** → **Lease** (ForeignKey - created_by_admin)
- **AdminUser** → **Maintenance** (ForeignKey - created_by_admin)

### Примеры использования системы

#### Пример 1: Полный цикл аренды автомобиля
1. **Клиент просматривает каталог**: 
   - Переходит на страницу /cars
   - Видит список доступных автомобилей с фильтрацией по марке, году, характеристикам
   - Выбирает автомобиль и нажимает "Подробнее"

2. **Подача заявки**:
   - На странице автомобиля нажимает "Арендовать"
   - Заполняет форму заявки с данными компании
   - Отправляет заявку на рассмотрение

3. **Администратор обрабатывает заявку**:
   - Видит новую заявку в разделе "Заявки"
   - Проверяет доступность автомобиля
   - Одобряет заявку, создавая договор аренды
   - Указывает даты аренды и стоимость

4. **Создание договора**:
   - Система автоматически создает договор
   - Автомобиль переводится в статус "В аренде"
   - Клиент получает уведомление

#### Пример 2: Техническое обслуживание автомобиля
1. **Создание сервисной компании**:
   - Администратор добавляет новую СТО через раздел "Обслуживание"
   - Указывает контактные данные и адрес

2. **Добавление записи об обслуживании**:
   - Переходит к конкретному автомобилю
   - Нажимает "Обслуживание" → "Добавить обслуживание"
   - Выбирает сервисную компанию из списка
   - Заполняет данные об услуге, стоимости и описании

3. **Просмотр истории обслуживания**:
   - Вся история обслуживания доступна на странице автомобиля
   - Возможность фильтрации по дате, сервису, стоимости
   - Статистика затрат на обслуживание

#### Пример 3: Анализ эффективности автопарка
1. **Просмотр отчетов**:
   - Администратор переходит в раздел "Отчеты"
   - Выбирает отчет "Доходы по аренде"
   - Видит таблицу с доходами по каждому автомобилю
   - Анализирует наиболее доходные модели

2. **Оптимизация загрузки**:
   - Просматривает отчет "Загрузка автопарка"
   - Определяет автомобили с низкой загрузкой
   - Принимает решения о продаже или рекламе

3. **Контроль затрат**:
   - Анализирует отчет "Затраты на обслуживание"
   - Выявляет автомобили с высокими затратами
   - Планирует профилактические мероприятия

### Особенности реализации

#### Безопасность
- JWT аутентификация с автоматическим обновлением токенов
- Защита маршрутов на уровне Vue Router
- Валидация всех входных данных на клиенте и сервере
- Защита от XSS и CSRF атак

#### Производительность
- Быстрая загрузка компонентов
- Пагинация больших списков
- Оптимизированные API запросы

#### UX/UI
- Адаптивный дизайн 
- Интуитивная навигация
- Визуальная обратная связь для всех действий
- Единый стиль интерфейса

#### Масштабируемость
- Модульная архитектура компонентов
- Централизованное управление состоянием
- Легкое добавление новых функциональных модулей

### Заключение

Разработанная frontend часть системы управления автопарком лизинговой компании представляет собой полнофункциональное современное веб-приложение, которое:

1. **Обеспечивает удобный интерфейс** для клиентов и администраторов
2. **Автоматизирует ключевые бизнес-процессы** компании
3. **Предоставляет инструменты аналитики** для принятия управленческих решений
4. **Обеспечивает безопасность** и сохранность данных
5. **Легко масштабируется** и поддерживается

Система готова к эксплуатации и может быть развернута как на собственной инфраструктуре компании, так и в облачных средах.
```
